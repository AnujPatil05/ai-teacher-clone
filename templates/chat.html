<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Teacher Clone - Chat</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      /* Header */
      .header {
        background: rgba(30, 60, 114, 0.95);
        backdrop-filter: blur(10px);
        border-bottom: 2px solid rgba(139, 92, 246, 0.3);
        color: white;
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logo {
        font-size: 32px;
      }

      .header-title h1 {
        font-size: 1.5em;
        margin-bottom: 3px;
      }

      .header-subtitle {
        font-size: 0.85em;
        opacity: 0.8;
      }

      .stats-compact {
        display: flex;
        gap: 25px;
        align-items: center;
      }

      .stat-compact {
        text-align: center;
      }

      .stat-value-compact {
        font-size: 1.3em;
        font-weight: bold;
        color: #a78bfa;
      }

      .stat-label-compact {
        font-size: 0.75em;
        opacity: 0.7;
      }

      .feature-badges {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .feature-badge {
        background: rgba(139, 92, 246, 0.3);
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 0.75em;
        border: 1px solid rgba(139, 92, 246, 0.5);
      }

      /* Main Chat Container */
      .chat-wrapper {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      .chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 30px;
        background: linear-gradient(
          180deg,
          rgba(42, 82, 152, 0.3) 0%,
          rgba(30, 60, 114, 0.5) 100%
        );
      }

      .message {
        margin-bottom: 25px;
        display: flex;
        gap: 15px;
        animation: slideIn 0.3s ease;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        flex-direction: row-reverse;
      }

      .message-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        flex-shrink: 0;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      .user .message-avatar {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
      }

      .bot .message-avatar {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      }

      .message-content {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px 25px;
        border-radius: 20px;
        max-width: 75%;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        color: #1f2937;
        line-height: 1.7;
      }

      .user .message-content {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
      }

      .bot .message-content {
        background: white;
      }

      .audio-player {
        margin-top: 15px;
        width: 100%;
        border-radius: 10px;
      }

      /* Input Area */
      .input-area {
        padding: 20px 30px;
        background: rgba(30, 60, 114, 0.95);
        backdrop-filter: blur(10px);
        border-top: 2px solid rgba(139, 92, 246, 0.3);
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
      }

      .input-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .controls {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        align-items: center;
      }

      .toggle-switch {
        display: flex;
        align-items: center;
        gap: 10px;
        color: white;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 26px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.2);
        transition: 0.4s;
        border-radius: 26px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      }

      input:checked + .slider:before {
        transform: translateX(24px);
      }

      .loading {
        display: none;
        text-align: center;
        padding: 10px;
        color: #a78bfa;
      }

      .loading.active {
        display: block;
      }

      .input-group {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .input-field {
        flex: 1;
        padding: 18px 25px;
        border: 2px solid rgba(139, 92, 246, 0.3);
        border-radius: 30px;
        font-size: 16px;
        outline: none;
        transition: all 0.3s;
        background: rgba(255, 255, 255, 0.95);
        color: #1f2937;
      }

      .input-field:focus {
        border-color: #8b5cf6;
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        background: white;
      }

      .send-btn {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
        border: none;
        padding: 18px 40px;
        border-radius: 30px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
      }

      .send-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
      }

      .send-btn:active {
        transform: translateY(0);
      }

      .send-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      /* Scrollbar Styling */
      .chat-container::-webkit-scrollbar {
        width: 8px;
      }

      .chat-container::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
      }

      .chat-container::-webkit-scrollbar-thumb {
        background: rgba(139, 92, 246, 0.5);
        border-radius: 4px;
      }

      .chat-container::-webkit-scrollbar-thumb:hover {
        background: rgba(139, 92, 246, 0.7);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .stats-compact {
          display: none;
        }

        .message-content {
          max-width: 85%;
        }

        .header {
          padding: 15px;
        }

        .chat-container {
          padding: 20px 15px;
        }

        .input-area {
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <div class="logo">üéì</div>
        <div class="header-title">
          <h1>AI Teacher Clone</h1>
          <div class="header-subtitle">
            Gate Smashers - Personalized Learning
          </div>
        </div>
      </div>

      <div class="stats-compact">
        <div class="stat-compact">
          <div class="stat-value-compact" id="messageCount">0</div>
          <div class="stat-label-compact">Messages</div>
        </div>
        <div class="stat-compact">
          <div class="stat-value-compact">6</div>
          <div class="stat-label-compact">Lectures</div>
        </div>
        <div class="stat-compact">
          <div class="stat-value-compact">100%</div>
          <div class="stat-label-compact">Accuracy</div>
        </div>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-wrapper">
      <div class="chat-container" id="chatContainer">
        <div class="message bot">
          <div class="message-avatar">ü§ñ</div>
          <div class="message-content">
            Namaste! üôè Main Gate Smashers ka AI clone hoon. Aap mujhse DBMS,
            Operating Systems, ya koi bhi CS concept ke baare mein puch sakte
            ho. Main Gate Smashers ki teaching style mein aapko samjhaunga!
            <br /><br />
            <strong>Try asking:</strong>
            <br />‚Ä¢ "DBMS mein normalization kya hai?" <br />‚Ä¢ "Explain deadlock
            in OS" <br />‚Ä¢ "What is polymorphism?"
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <div class="controls">
          <div class="toggle-switch">
            <label class="switch">
              <input type="checkbox" id="voiceToggle" checked />
              <span class="slider"></span>
            </label>
            <span>üîä Voice Response</span>
          </div>
          <div class="feature-badges">
            <span class="feature-badge">‚úì RAG</span>
            <span class="feature-badge">‚úì Voice</span>
            <span class="feature-badge">‚úì Hinglish</span>
          </div>
        </div>
        <div class="loading" id="loading">
          <div>ü§î Teacher is thinking...</div>
        </div>
        <div class="input-group">
          <input
            type="text"
            class="input-field"
            id="questionInput"
            placeholder="Ask your question in Hindi or English..."
            onkeypress="if(event.key==='Enter') sendMessage()"
          />
          <button class="send-btn" onclick="sendMessage()" id="sendBtn">
            Send üì§
          </button>
        </div>
      </div>
    </div>

    <script>
      let messageCount = 0;

      function addMessage(content, isUser, audioUrl = null) {
        const chatContainer = document.getElementById("chatContainer");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${isUser ? "user" : "bot"}`;

        const avatar = document.createElement("div");
        avatar.className = "message-avatar";
        avatar.textContent = isUser ? "üë§" : "ü§ñ";

        const contentDiv = document.createElement("div");
        contentDiv.className = "message-content";
        contentDiv.innerHTML = content.replace(/\n/g, "<br>");

        if (audioUrl) {
          const audio = document.createElement("audio");
          audio.className = "audio-player";
          audio.controls = true;
          audio.src = audioUrl;
          contentDiv.appendChild(audio);
        }

        messageDiv.appendChild(avatar);
        messageDiv.appendChild(contentDiv);
        chatContainer.appendChild(messageDiv);

        chatContainer.scrollTop = chatContainer.scrollHeight;

        if (!isUser) {
          messageCount++;
          document.getElementById("messageCount").textContent = messageCount;
        }
      }

      async function sendMessage() {
        const input = document.getElementById("questionInput");
        const question = input.value.trim();

        if (!question) return;

        const sendBtn = document.getElementById("sendBtn");
        const loading = document.getElementById("loading");
        const voiceEnabled = document.getElementById("voiceToggle").checked;

        addMessage(question, true);
        input.value = "";

        sendBtn.disabled = true;
        loading.classList.add("active");

        try {
          const response = await fetch("/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              question: question,
              voice: voiceEnabled,
            }),
          });

          const data = await response.json();
          addMessage(data.response, false, data.audio_url);
        } catch (error) {
          addMessage(
            "Sorry, there was an error processing your request. Please try again.",
            false
          );
          console.error("Error:", error);
        } finally {
          sendBtn.disabled = false;
          loading.classList.remove("active");
        }
      }

      document.getElementById("questionInput").focus();
    </script>
  </body>
</html>
